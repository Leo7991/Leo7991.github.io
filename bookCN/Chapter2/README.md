# äº§å“ç‰¹æ€§

#### ğŸš€ åŸºäºRails 6

ä¸`rails 5`ä¸åŒï¼Œ`rails 6`æ˜¯æœªæ¥å‘å±•çš„å¿…ç„¶è¶‹åŠ¿ã€‚

#### ğŸš€ Rails API

ä½¿ç”¨æµè¡Œå‰ç«¯çš„jsåº“å¦‚`react`ï¼Œ`vuejs`ï¼Œæ›¿æ¢åŸæ¥çš„`rails view`

#### ğŸš€ ActionCable

è¯¥é¡¹ç›®æ¼”ç¤ºäº†èŠå¤©çš„åç«¯æ˜¯å¦‚ä½•ä½¿ç”¨JWTè®¤è¯èº«ä»½çš„actioncableï¼Œå…¶åŠŸèƒ½å¦‚ä¸‹ï¼š

- ç”¨æˆ·å¯ä»¥
  - åˆ›å»º/åˆ é™¤æˆ¿é—´
  - è®¾ç½®ä»–/å¥¹çš„å¤´åƒ
- å…¶ä»–ç”¨æˆ·å¯ä»¥åŠ å…¥æˆ¿é—´
- åœ¨æˆ¿é—´å†…çš„ç”¨æˆ·å¯ä»¥
  - äº’ç›¸å‘é€æ¶ˆæ¯
  - æ›´æ–°æ¶ˆæ¯
  - åˆ é™¤æ¶ˆæ¯
  - å‘èµ·å…¶ä»–äººå¯ä»¥å‚åŠ çš„æŠ•ç¥¨
  - éšæœºé€‰å–æˆ¿é—´å†…ç‰¹å®šæ•°é‡çš„ç”¨æˆ·

ç›¸å…³çš„fronendæ¼”ç¤ºæ˜¯ç”¨[react-pangu](https://github.com/ruilisi/react-pangu)ç¼–å†™ï¼Œæ¡¥æ¥å‰ç«¯å’Œåç«¯çš„jsåº“æ˜¯ç”¨çš„æ˜¯[actioncable-jwt](https://github.com/ruilisi/actioncable-jwt)ã€‚

#### ğŸš€ [Devise](https://github.com/plataformatec/devise)

æ¥è‡ªDeviseå®˜æ–¹æ–‡æ¡£ï¼š

> Deviseæ˜¯åŸºäºWardençš„Railsèº«ä»½éªŒè¯è§£å†³æ–¹æ¡ˆã€‚å®ƒå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
>
> - åŸºäºRack;
> - æ˜¯ä¸€ä¸ªåŸºäºRailså¼•æ“çš„å®Œæ•´MVCè§£å†³æ–¹æ¡ˆ;
> - å…è®¸æ‚¨åŒæ—¶è¿è¡Œå¤šä¸ªæ¨¡å‹;
> - åŠŸèƒ½æ¨¡å—åŒ–ï¼Œåªéœ€è¦è°ƒç”¨æ‰€éœ€è¦çš„æ¨¡å—ã€‚

ç”±æ­¤å¯è§ï¼Œ`devise`æä¾›äº†ä¸€å¥—å®Œæ•´çš„ç¬¦åˆè¡Œä¸šæ ‡å‡†ä¸”æ–¹ä¾¿ä½¿ç”¨çš„èº«ä»½éªŒè¯æ–¹å¼ã€‚

#### ğŸš€ JWT

JSON Web Tokensï¼Œæ˜¯ç›®å‰æœ€æµè¡Œçš„è·¨åŸŸè®¤è¯è§£å†³æ–¹æ¡ˆã€‚

#### ğŸš€ [devise-jwt](https://github.com/waiting-for-dev/devise-jwt)

å®ç°äº†å°†`devise`å’Œ`jwt`æŠ€æœ¯èåˆï¼Œè™½ç„¶ä¹Ÿæœ‰å…¶ä»–å¼€å‘è€…é€šè¿‡å…¶å®ƒæ–¹å¼å®ç°äº†ä¸¤è€…çš„èåˆè¿ç”¨ï¼Œä½†éƒ½æ•ˆæœæ¬ ä½³ã€‚

æˆ‘ä»¬åœ¨ [app/models/jwt_denylist.rb](https://github.com/ruilisi/Rails-pangu/blob/master/app/models/jwt_denylist.rb) é‡Œé¢é€šè¿‡ä½¿ç”¨rediså®ç°äº† devise-jwtçš„ `denylist strategy`ã€‚

#### ğŸš€ Postgres

ä½¿ç”¨postgresä½œä¸ºé»˜è®¤æ•°æ®åº“ã€‚å½“ä¸€ä¸ªWebæœåŠ¡å™¨çš„æµé‡å˜å¾—å¾ˆå¤§æ—¶ï¼Œsqlite3æ˜¾ç„¶æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚

#### ğŸš€ Rspec

Rubyè¡Œä¸ºé©±åŠ¨æµ‹è¯•æ¡†æ¶ï¼Œè®©TDDé«˜æ•ˆæœ‰è¶£ã€‚

#### ğŸš€ [RuboCop](https://docs.rubocop.org/)

Rubyä»£ç é™æ€åˆ†æå’Œæ ¼å¼å·¥å…·ï¼ŒåŸºäºç¤¾åŒºRubyæ ·å¼å‡†ä¾§

#### ğŸš€ [CircleCI](https://circleci.com/)

CircleCIæ˜¯ä¸€ä¸ªè¡Œä¸šæµè¡Œçš„æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²çš„å¼€å‘å·¥å…·ï¼Œæ–¹ä¾¿ä¸å›¢é˜Ÿæˆå‘˜ä¹‹é—´ä»£ç äº¤æµï¼Œå¯†åˆ‡åä½œã€‚ åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡CircleCIç”¨`rspec`å’Œ`RuboCop`æ¥æµ‹è¯•`Rails-pangu`çš„ä»£ç åº“ã€‚

#### ğŸš€ [Factory Bot](https://github.com/thoughtbot/factory_bothttps://github.com/thoughtbot/factory_bot)

å°†Rubyå¯¹è±¡è®¾ç½®ä¸ºæµ‹è¯•ç”¨ä¾‹ã€‚

#### ğŸš€ Docker

Dockeræ˜¯æ ‡å‡†çš„è½»é‡çº§æ“ä½œç³»ç»Ÿè™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆï¼Œåœ¨å…¨çƒå¾—åˆ°äº†å¹¿æ³›åº”ç”¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¹Ÿä¸€å¹¶æä¾›äº†Dockerfileæ–‡ä»¶å’Œè„šæœ¬æ¥å¸®åŠ©ç”Ÿæˆdockeré•œåƒã€‚

æœ¬é¡¹ç›®æä¾›çš„Dockeræ„å»ºæ–¹æ¡ˆåŒ…å«äº†ä¸¤å¤§ä¼˜åŒ–:

- Dockeré•œåƒæ„å»ºåŠ é€Ÿ

  å½“ä¸€ä¸ªé¡¹ç›®è¿­ä»£å¢é•¿æ—¶ï¼Œä¸Šç™¾ç”šè‡³ä¸Šåƒä¸ªGemä¼šè¢«å°è¯•æˆ–è€…ä½¿ç”¨ã€‚å³ä½¿æ˜¯å¯¹`Gemfile`çš„ä¸€ä¸ªå¾®å°å˜åŠ¨éƒ½ä¼šè§¦å‘ä¸€æ¬¡æ‰€æœ‰Gemçš„é‡æ–°bundleï¼Œæ•…è€Œç»å¤§éƒ¨åˆ†bundleæ—¶é—´éƒ½æµªè´¹åœ¨å»bundleç»å¤§å¤šæ•°ç¨³å®šçš„Gemï¼Œä¾‹å¦‚ï¼š`rails`, `pg`ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå°æŠ€å·§æ¥åŠ é€Ÿdockeræ„å»ºè¿‡ç¨‹ã€‚è¿™ä¸ªæŠ€å·§å°±æ˜¯åˆ†ä¸¤æ¬¡æ¥bundle `Gemfile`ï¼Œç„¶åäº§ç”Ÿä¸¤å±‚é•œåƒæ–‡ä»¶ï¼š

  - ç¬¬ä¸€æ¬¡ä¸º`Gemfile.core`æ„å»ºé•œåƒå±‚ï¼Œè¯¥æ–‡ä»¶æœåŠ¡äºç¨³å®šæˆ–è€…æ ¸å¿ƒçš„`Gem`ï¼Œä¾‹å¦‚`rails`, `pg`ã€‚
  - ç¬¬äºŒæ¬¡ä¸º`Gemfile`æ„å»ºé•œåƒå±‚ï¼Œè¯¥æ–‡ä»¶æœåŠ¡äºæ˜“äºå˜åŒ–çš„æˆ–è€…éæ ¸å¿ƒçš„`Gem`ï¼Œ ä¾‹å¦‚ä½ è‡ªå·±å†™çš„æˆ–è€…forkedé¡¹ç›®ã€‚

  å°½ç®¡è¿™ä¸ªè¿‡ç¨‹ä¼šç”Ÿæˆé¢å¤–çš„Dockeré•œåƒå±‚ï¼Œä½¿é•œåƒå˜å¤§ï¼ˆé¢„è®¡å‡ ç™¾KBï¼‰ï¼Œä½†è¿™æ ·åšæ˜¯æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºç¨‹åºè¿è¡Œæ—¶é—´æ¯”ç£ç›˜ç©ºé—´è¦æœ‰é™å¾—å¤šã€‚

  ä¸‹é¢çš„`Dockerfile`ä»£ç ç‰‡æ®µæ¼”ç¤ºäº†è¯¥é•œåƒæ„å»ºè¿‡ç¨‹ï¼š

```
COPY Gemfile.core .
RUN echo 'gem: --no-document' >> ~/.gemrc && \
    cp ~/.gemrc /etc/gemrc && \
    chmod +r /etc/gemrc && \
    bundle install --gemfile Gemfile.core -j16 --binstubs=$BUNDLE_PATH/bin

COPY Gemfile .
COPY Gemfile.lock .
RUN bundle install --gemfile Gemfile -j16 --binstubs=$BUNDLE_PATH/bin
```

- Gemæ„å»ºåŠ é€Ÿ (ä»…ä¸ºä¸­å›½å¼€å‘è€…æä¾›)

  æˆ‘ä»¬ä¼šå°†Gemæº `https://rubygems.org` é•œåƒåˆ° `https://gems.ruby-china.com`, è¿™ä¼šå¸®åŠ©ä¸­å›½å¼€å‘è€…åŠ é€ŸGemæ„å»ºé€Ÿåº¦ã€‚

#### ğŸš€ [Puma](https://github.com/puma/puma)

Pumaæ˜¯ä¸€ä¸ªç®€å•ã€å¿«é€Ÿã€çº¿ç¨‹åŒ–ã€é«˜åº¦å¹¶å‘çš„HTTP1.1æœåŠ¡å™¨ï¼Œç”¨äºRuby/Rackåº”ç”¨çš„å¼€å‘ã€‚

#### ğŸš€ Redis

å‡ ä¹æ‰€æœ‰çš„Webé¡¹ç›®éƒ½ä½¿ç”¨`redis`ä½œä¸ºå­˜å‚¨ç³»ç»Ÿï¼Œå› ä¸ºå®ƒå¿«é€Ÿã€é«˜æ•ˆã€ç®€æ´ã€‚